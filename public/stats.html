<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –Ø –º–æ–ª–æ–¥–µ—Ü!</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stats-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .stats-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card.large {
            grid-column: span 2;
        }
        
        .stat-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .stat-trend {
            font-size: 0.8em;
            padding: 3px 10px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .stat-trend.up {
            background: #d4edda;
            color: #155724;
        }
        
        .stat-trend.down {
            background: #f8d7da;
            color: #721c24;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }
        
        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .period-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .period-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .achievement-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .achievement-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .achievement-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-desc {
            font-size: 0.8em;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="/dashboard.html" class="logo">
                    <i class="fas fa-fire"></i>
                    <span>–Ø –º–æ–ª–æ–¥–µ—Ü!</span>
                </a>
            </div>
            
            <div class="nav-menu">
                <a href="/dashboard.html" class="nav-link">
                    <i class="fas fa-home"></i> –î–∞—à–±–æ—Ä–¥
                </a>
                <a href="/calendar.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i> –ö–∞–ª–µ–Ω–¥–∞—Ä—å
                </a>
                <a href="/stats.html" class="nav-link active">
                    <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </a>
                <a href="/admin.html" class="nav-link">
                    <i class="fas fa-crown"></i> –ê–¥–º–∏–Ω
                </a>
            </div>
            
            <div class="nav-user">
                <div class="user-dropdown">
                    <button class="user-btn">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <span id="username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="main-content">
        <div class="stats-container">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="stats-header">
                <h1><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h1>
                <p>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ —É—Å–ø–µ—Ö–∏ –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å –ª—É—á—à–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</p>
            </div>

            <!-- –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
            <div class="period-selector">
                <button class="period-btn active" data-period="week">–ù–µ–¥–µ–ª—è</button>
                <button class="period-btn" data-period="month">–ú–µ—Å—è—Ü</button>
                <button class="period-btn" data-period="year">–ì–æ–¥</button>
                <button class="period-btn" data-period="all">–í—Å–µ –≤—Ä–µ–º—è</button>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-grid" id="overview-stats">
                <div class="stat-card large">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value" id="completion-rate">0%</div>
                    <div class="stat-label">–û–±—â–∞—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å</div>
                    <div class="stat-trend up" id="trend-indicator">+0%</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-value" id="current-streak">0</div>
                    <div class="stat-label">–¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="completed-total">0</div>
                    <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤—Å–µ–≥–æ</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-value" id="active-days">0</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π</div>
                </div>
            </div>

            <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3><i class="fas fa-chart-line"></i> –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h3>
                    <div class="chart-wrapper">
                        <canvas id="completion-chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3><i class="fas fa-chart-pie"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏–≤—ã—á–∫–∞–º</h3>
                    <div class="chart-wrapper">
                        <canvas id="habits-chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3><i class="fas fa-running"></i> –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ü–µ–ª—è–º</h3>
                    <div class="chart-wrapper">
                        <canvas id="goals-chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3><i class="fas fa-calendar-check"></i> –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏</h3>
                    <div class="chart-wrapper">
                        <canvas id="weekly-activity-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
            <div class="chart-card">
                <h3><i class="fas fa-trophy"></i> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                <div id="achievements-container" class="achievements-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π...
                    </div>
                </div>
            </div>

            <!-- –ò–Ω—Å–∞–π—Ç—ã -->
            <div class="chart-card">
                <h3><i class="fas fa-lightbulb"></i> –ò–Ω—Å–∞–π—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                <div id="insights-container">
                    <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        let charts = {};
        let currentPeriod = 'month';

        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/index.html';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            try {
                const response = await fetch('/api/auth/me', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) {
                    window.location.href = '/index.html';
                    return;
                }
                
                const user = await response.json();
                document.getElementById('username').textContent = user.user?.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('user-avatar').textContent = user.user?.displayName?.[0] || 'U';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                window.location.href = '/index.html';
            }

            // –í—ã—Ö–æ–¥
            document.getElementById('logout-btn').addEventListener('click', () => {
                localStorage.removeItem('token');
                window.location.href = '/index.html';
            });

            // –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period;
                    loadStats();
                });
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            await loadStats();
        });

        async function loadStats() {
            try {
                const token = localStorage.getItem('token');
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('overview-stats').innerHTML = `
                    <div class="stat-card large" style="grid-column: span 4; text-align: center;">
                        <div class="loading">
                            <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...
                        </div>
                    </div>
                `;

                // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const statsResponse = await fetch(`/api/entries/stats?period=${currentPeriod}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!statsResponse.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
                }

                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    updateOverviewStats(statsData.data);
                    createCharts(statsData.data);
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                await loadAchievements(token);

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å–∞–π—Ç–æ–≤
                await loadInsights(token);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                document.getElementById('overview-stats').innerHTML = `
                    <div class="stat-card large" style="grid-column: span 4; text-align: center; color: #dc3545;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>
                    </div>
                `;
            }
        }

        function updateOverviewStats(data) {
            const stats = data.stats || {};
            const streak = data.currentStreak || 0;
            
            document.getElementById('completion-rate').textContent = 
                `${Math.round(stats.completionRate || 0)}%`;
            
            document.getElementById('current-streak').textContent = streak;
            
            document.getElementById('completed-total').textContent = 
                `${stats.completed || 0}/${stats.total || 0}`;
            
            document.getElementById('active-days').textContent = 
                Math.floor(streak / 7) || 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–µ–Ω–¥
            const trendEl = document.getElementById('trend-indicator');
            const trend = (stats.completionRate || 0) - 50;
            trendEl.textContent = trend >= 0 ? `+${Math.round(trend)}%` : `${Math.round(trend)}%`;
            trendEl.className = `stat-trend ${trend >= 0 ? 'up' : 'down'}`;
        }

        function createCharts(data) {
            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};

            // 1. –ì—Ä–∞—Ñ–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ –¥–Ω—è–º
            const completionCtx = document.getElementById('completion-chart').getContext('2d');
            charts.completion = new Chart(completionCtx, {
                type: 'line',
                data: {
                    labels: generateDateLabels(currentPeriod),
                    datasets: [{
                        label: '–í—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å (%)',
                        data: generateRandomData(7, 40, 100),
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });

            // 2. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏–≤—ã—á–∫–∞–º
            const habitsCtx = document.getElementById('habits-chart').getContext('2d');
            charts.habits = new Chart(habitsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['–ó–¥–æ—Ä–æ–≤—å–µ', '–§–∏—Ç–Ω–µ—Å', '–û–±—É—á–µ–Ω–∏–µ', '–†–∞–±–æ—Ç–∞', '–î—Ä—É–≥–æ–µ'],
                    datasets: [{
                        data: [25, 20, 15, 30, 10],
                        backgroundColor: ['#4CAF50', '#2196F3', '#FFC107', '#9C27B0', '#FF5722']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // 3. –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ü–µ–ª—è–º
            const goalsCtx = document.getElementById('goals-chart').getContext('2d');
            charts.goals = new Chart(goalsCtx, {
                type: 'bar',
                data: {
                    labels: ['–¶–µ–ª—å 1', '–¶–µ–ª—å 2', '–¶–µ–ª—å 3'],
                    datasets: [{
                        label: '–ü—Ä–æ–≥—Ä–µ—Å—Å',
                        data: [75, 45, 90],
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });

            // 4. –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏
            const weeklyCtx = document.getElementById('weekly-activity-chart').getContext('2d');
            charts.weekly = new Chart(weeklyCtx, {
                type: 'radar',
                data: {
                    labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
                    datasets: [{
                        label: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
                        data: [85, 70, 90, 65, 95, 40, 30],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: '#667eea',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        async function loadAchievements(token) {
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
                const achievements = [
                    { icon: 'üéØ', title: '–ü–µ—Ä–≤—ã–π —à–∞–≥', desc: '–°–æ–∑–¥–∞–ª –ø–µ—Ä–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É' },
                    { icon: 'üî•', title: '–ù–µ–¥–µ–ª—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã', desc: '7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥' },
                    { icon: 'üìö', title: '–£—á–µ–Ω–∏–∫', desc: '10 –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫' },
                    { icon: '‚≠ê', title: '–ò–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å', desc: '100% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ' }
                ];
                
                const container = document.getElementById('achievements-container');
                let html = '';
                
                achievements.forEach(ach => {
                    html += `
                        <div class="achievement-card">
                            <div class="achievement-icon">${ach.icon}</div>
                            <div class="achievement-title">${ach.title}</div>
                            <div class="achievement-desc">${ach.desc}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π:', error);
            }
        }

        async function loadInsights(token) {
            try {
                const insights = [
                    "–í–∞—à –ª—É—á—à–∏–π –¥–µ–Ω—å - –ø—è—Ç–Ω–∏—Ü–∞ (95% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)",
                    "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏",
                    "–ù–µ–¥–µ–ª—å–Ω—ã–π —Å—Ç—Ä–∏–∫ –ø–æ—á—Ç–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!",
                    "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º: —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≤—ã—á–µ–∫, –Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ"
                ];
                
                const container = document.getElementById('insights-container');
                let html = '<ul>';
                
                insights.forEach(insight => {
                    html += `<li><i class="fas fa-lightbulb"></i> ${insight}</li>`;
                });
                
                html += '</ul>';
                container.innerHTML = html;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Å–∞–π—Ç–æ–≤:', error);
            }
        }

        function generateDateLabels(period) {
            const labels = [];
            const days = period === 'week' ? 7 : period === 'month' ? 30 : 7;
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' }));
            }
            
            return labels;
        }

        function generateRandomData(count, min, max) {
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push(Math.floor(Math.random() * (max - min + 1)) + min);
            }
            return data;
        }

        // –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function exportStats() {
            const data = {
                exportedAt: new Date().toISOString(),
                period: currentPeriod,
                stats: {}
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>